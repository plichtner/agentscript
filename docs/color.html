<!DOCTYPE html>

<html>
<head>
  <title>color.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>color.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>Color = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Color utilities.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Convert 3 or 4 ints to a html/css color string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbString</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">1</span>)</span> -&gt;</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"alpha &gt; 1"</span> <span class="hljs-keyword">if</span> a &gt; <span class="hljs-number">1</span> <span class="hljs-comment"># a: 0-1 not 0-255</span>
    <span class="hljs-keyword">if</span> a <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"rgb(<span class="hljs-subst">#{r}</span>,<span class="hljs-subst">#{g}</span>,<span class="hljs-subst">#{b}</span>)"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"rgba(<span class="hljs-subst">#{r}</span>,<span class="hljs-subst">#{g}</span>,<span class="hljs-subst">#{b}</span>,<span class="hljs-subst">#{a}</span>)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Return the gray/intensity value for a given r,g,b color</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbIntensity</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span> <span class="hljs-number">0.2126</span>*r + <span class="hljs-number">0.7152</span>*g + <span class="hljs-number">0.0722</span>*b</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Return a web/html/css hex color string for an r,g,b color</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbToHex</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
    <span class="hljs-string">"#"</span> + (<span class="hljs-number">0x1000000</span> | (b | g &lt;&lt; <span class="hljs-number">8</span> | r &lt;&lt; <span class="hljs-number">16</span>)).toString(<span class="hljs-number">16</span>).slice(-<span class="hljs-number">6</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Return 2 typed array colors: a single Uint32 pixel, correct endian format,
and a 4 Uint8Array, r,g,b,a255 (i.e. a int in 0-255)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">typedArrayColor</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">255</span>)</span> -&gt;</span>
    rgba = <span class="hljs-keyword">new</span> Uint8ClampedArray([r, g, b, a])
    pixel = <span class="hljs-keyword">new</span> Uint32Array(rgba.buffer)[<span class="hljs-number">0</span>]
    {pixel, rgba}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Return an RGB array given any legal CSS color, null otherwise.
<a href="http://www.w3schools.com/cssref/css_colors_legal.asp">http://www.w3schools.com/cssref/css_colors_legal.asp</a>
The string can be CadetBlue, #0f0, rgb(255,0,0), hsl(120,100%,50%)
The rgba/hsla forms ok too, but we don’t return the a.
Note: The browser speaks for itself: we simply set a 1x1 canvas fillStyle
to the string and create a pixel, returning the r,g,b values.
Warning: r=g=b=0 can indicate an illegal string.  We test
for a few obvious cases but beware of unexpected [0,0,0] results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">ctx1x1</span>: u.createCtx <span class="hljs-number">1</span>, <span class="hljs-number">1</span> <span class="hljs-comment"># share across calls. closure wrapper better?</span>
  <span class="hljs-attribute">stringToRGB</span>: <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
    <span class="hljs-property">@ctx1x1</span>.fillStyle = string
    <span class="hljs-property">@ctx1x1</span>.fillRect <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>
    [r, g, b, a] = <span class="hljs-property">@ctx1x1</span>.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>).data
    <span class="hljs-keyword">return</span> [r, g, b] <span class="hljs-keyword">if</span> (r+g+b <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">or</span>
      (string.match(<span class="hljs-regexp">/^black$/i</span>)) <span class="hljs-keyword">or</span>
      (string <span class="hljs-keyword">in</span> [<span class="hljs-string">"#000"</span>,<span class="hljs-string">"#000000"</span>]) <span class="hljs-keyword">or</span>
      (string.match(<span class="hljs-regexp">/rgba{0,1}\(0,0,0/i</span>)) <span class="hljs-keyword">or</span>
      (string.match(<span class="hljs-regexp">/hsla{0,1}\(0,0%,0%/i</span>))
    <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Convert rgb color to hsb/hsv color array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbToHsv</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
    r=r/<span class="hljs-number">255</span>; g=g/<span class="hljs-number">255</span>; b=b/<span class="hljs-number">255</span>
    max = Math.max(r,g,b); min = Math.min(r,g,b); v = max
    h = <span class="hljs-number">0</span>; d = max-min; s = <span class="hljs-keyword">if</span> max <span class="hljs-keyword">is</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> d/max
    <span class="hljs-keyword">if</span> max <span class="hljs-keyword">isnt</span> min <span class="hljs-keyword">then</span> <span class="hljs-keyword">switch</span> max
      <span class="hljs-keyword">when</span> r <span class="hljs-keyword">then</span> h = (g - b) / d + (<span class="hljs-keyword">if</span> g &lt; b <span class="hljs-keyword">then</span> <span class="hljs-number">6</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)
      <span class="hljs-keyword">when</span> g <span class="hljs-keyword">then</span> h = (b - r) / d + <span class="hljs-number">2</span>
      <span class="hljs-keyword">when</span> b <span class="hljs-keyword">then</span> h = (r - g) / d + <span class="hljs-number">4</span>
    [Math.round(<span class="hljs-number">255</span>*h/<span class="hljs-number">6</span>), Math.round(<span class="hljs-number">255</span>*s), Math.round(<span class="hljs-number">255</span>*v)]</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Convert hsv back to rgb</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">hsvToRgb</span>: <span class="hljs-function"><span class="hljs-params">(h, s, v)</span> -&gt;</span>
    h=h/<span class="hljs-number">255</span>; s=s/<span class="hljs-number">255</span>; v=v/<span class="hljs-number">255</span>; i = Math.floor(h*<span class="hljs-number">6</span>)
    f = h * <span class="hljs-number">6</span> - i;        p = v * (<span class="hljs-number">1</span> - s)
    q = v * (<span class="hljs-number">1</span> - f * s);  t = v * (<span class="hljs-number">1</span> - (<span class="hljs-number">1</span> - f) * s)
    <span class="hljs-keyword">switch</span>(i % <span class="hljs-number">6</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> r = v; g = t; b = p
      <span class="hljs-keyword">when</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> r = q; g = v; b = p
      <span class="hljs-keyword">when</span> <span class="hljs-number">2</span> <span class="hljs-keyword">then</span> r = p; g = v; b = t
      <span class="hljs-keyword">when</span> <span class="hljs-number">3</span> <span class="hljs-keyword">then</span> r = p; g = q; b = v
      <span class="hljs-keyword">when</span> <span class="hljs-number">4</span> <span class="hljs-keyword">then</span> r = t; g = p; b = v
      <span class="hljs-keyword">when</span> <span class="hljs-number">5</span> <span class="hljs-keyword">then</span> r = v; g = p; b = q
    [Math.round(r*<span class="hljs-number">255</span>), Math.round(g*<span class="hljs-number">255</span>), Math.round(b*<span class="hljs-number">255</span>)] <span class="hljs-comment"># floor??</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return array of 3 random values in 0-255.  OK for both RGB/HSV</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">randomColor</span>:<span class="hljs-function"> -&gt;</span> (u.randomInt(<span class="hljs-number">256</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.2</span>])</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Return a distance metric between two colors.
Max distance is roughly 765 (3*255), between black &amp; white
<a href="http://www.compuphase.com/cmetric.htm">http://www.compuphase.com/cmetric.htm</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbDistance</span>: <span class="hljs-function"><span class="hljs-params">(r1, g1, b1, r2, g2, b2)</span> -&gt;</span>
    rMean = Math.round( (r1 + r2) / <span class="hljs-number">2</span> )
    [dr, dg, db] = [r1 - r2, g1 - g2, b1 - b2]
    Math.sqrt (((<span class="hljs-number">512</span>+rMean)*dr*dr)&gt;&gt;<span class="hljs-number">8</span>) + (<span class="hljs-number">4</span>*dg*dg) + (((<span class="hljs-number">767</span>-rMean)*db*db)&gt;&gt;<span class="hljs-number">8</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>A very crude way to scale a data value to an rgb color.
value is in [min max], rgb’s are two color.
See ColorMap.scaleColor for another method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbLerp</span>: <span class="hljs-function"><span class="hljs-params">(value, min, max, rgb1, rgb0 = [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>])</span> -&gt;</span>
    scale = u.lerpScale value, min, max <span class="hljs-comment">#(value - min)/(max - min)</span>
    (Math.round(u.lerp(rgb0[i], rgb1[i], scale))) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.2</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Create color object from r,g,b,a
Note a between 0-1, not 0-255
The object contains many properties relating to
the r,g,b,a color:
  r, g, b, h, s, v: color integers, 0-255 based
  a, a255: alpha, a float in 0-1, a255 integer in 0-255
  rgb, hsb: array forms of the two colors
  intensity: the gray value for the rgb color
  rgba, pixel: typed array values.
  rgbString, hexString: two html/css color formats</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Experimental:
Control the number of color features in colorObject.
To remove intensity, call options() for a
set of all-true options, and turn off the ones you don’t need.
If all options false, only r,g,b,a remain.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">options</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-attribute">rgb</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attribute">hsv</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attribute">pixel</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attribute">rgbString</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attribute">hexString</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attribute">intensity</span>: <span class="hljs-literal">true</span>

  <span class="hljs-attribute">colorObject</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">1</span>, opt=<span class="hljs-property">@options</span>())</span> -&gt;</span>
    o = {r,g,b,a}
    <span class="hljs-keyword">if</span> opt.rgb
      o.rgb = [r, g, b]
    <span class="hljs-keyword">if</span> opt.hsv
      o.hsv = <span class="hljs-property">@rgbToHsv</span> r, g, b
      [o.h, o.s, o.v] = o.hsv
    <span class="hljs-keyword">if</span> opt.pixel
      o.a255 = Math.round(a*<span class="hljs-number">255</span>)
      {pixel, rgba} = <span class="hljs-property">@typedArrayColor</span> r, g, b, o.a255
      [o.pixel, o.rgba] = [pixel, rgba]
    <span class="hljs-keyword">if</span> opt.rgbString
      o.rgbString = <span class="hljs-property">@rgbString</span> r, g, b, a
    <span class="hljs-keyword">if</span> opt.hexString
      o.hexString = <span class="hljs-property">@rgbToHex</span> r, g, b
    <span class="hljs-keyword">if</span> opt.intensity
      o.intensity = <span class="hljs-property">@rgbIntensity</span> r, g, b
    o</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>A colormap is an array of ColorObjects which have two additional
properties: map: the colormap and ix: the color’s index w/in map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">ColorMap</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ColorMap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Array</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>A colormap is an array of Color objects. Each ColorObject has
two new properties: ix, the array index, and map, the colormap
The ctor takes an array of [r,g,b] arrays. See factories above.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(rgbArray, <span class="hljs-property">@options</span> = Color.options(), <span class="hljs-property">@dupsOK</span> = <span class="hljs-literal">false</span>)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Note we keep a copy of the color options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>)
      <span class="hljs-property">@rgbIndex</span> = {}
      <span class="hljs-property">@nameIndex</span> = {}
      <span class="hljs-keyword">for</span> rgb, i <span class="hljs-keyword">in</span> rgbArray
        <span class="hljs-property">@addColor</span> rgb...</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Append a color to the the map if it isn’t already
in the map unless dupsOK.  Return the color object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">addColor</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">1</span>)</span> -&gt;</span>
      rgbString = Color.rgbString r, g, b, a
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@dupsOK</span>
        color = <span class="hljs-property">@rgbIndex</span>[ rgbString ]
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"dup color"</span>, color) <span class="hljs-keyword">if</span> color
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> color
        color = Color.colorObject r, g, b, a, <span class="hljs-property">@options</span>
        color.ix = <span class="hljs-property">@length</span>
        color.map = @
        <span class="hljs-property">@rgbIndex</span>[rgbString] = color
        <span class="hljs-property">@push</span> color
      color</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>The Array.sort, augmented by updating color.ix to correspond
to the new place in the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">sort</span>: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span>
      <span class="hljs-keyword">super</span> f
      color.ix = i <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
      @</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Sugar for sorting by color.key, mainly intensity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">sortBy</span>: <span class="hljs-function"><span class="hljs-params">(key, ascenting=<span class="hljs-literal">true</span>)</span> -&gt;</span>
      <span class="hljs-function"><span class="hljs-title">compare</span> = <span class="hljs-params">(a, b)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> ascenting <span class="hljs-keyword">then</span> a[key]-b[key] <span class="hljs-keyword">else</span> b[key]-a[key]
      <span class="hljs-property">@sort</span> compare</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Find an rgb color in the map, return undefined if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">findRGB</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">1</span>)</span> -&gt;</span>
      <span class="hljs-property">@rgbIndex</span>[ Color.rgbString(r, g, b, a) ]</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Find first color with the given key/value, undefined if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">findKey</span>: <span class="hljs-function"><span class="hljs-params">(key, value)</span> -&gt;</span>
      <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
        <span class="hljs-keyword">return</span> color <span class="hljs-keyword">if</span> color[key] <span class="hljs-keyword">is</span> value
      <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Return an random color or index in a map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">randomIndex</span>:<span class="hljs-function"> -&gt;</span> u.randomInt <span class="hljs-property">@length</span>
    <span class="hljs-attribute">randomColor</span>:<span class="hljs-function"> -&gt;</span> @[<span class="hljs-property">@randomIndex</span>()]</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Return the map color proportional to the value between min, max.
This is a linear interpolation based on the map indices.
The optional minColor, maxColor args are for using a subset of the map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">scaleColor</span>: <span class="hljs-function"><span class="hljs-params">(number, min, max, minColor = <span class="hljs-number">0</span>, maxColor = <span class="hljs-property">@length</span>-<span class="hljs-number">1</span>)</span> -&gt;</span>
      scale = u.lerpScale number, min, max <span class="hljs-comment"># (number-min)/(max-min)</span>
      minColor = minColor.ix <span class="hljs-keyword">if</span> minColor.ix?
      maxColor = maxColor.ix <span class="hljs-keyword">if</span> maxColor.ix?
      index = Math.round(u.lerp minColor, maxColor, scale)
      @[index]</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Find the color closest to this color, using Color.rgbDistance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">findClosest</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> color <span class="hljs-keyword">if</span> ( color = <span class="hljs-property">@findRGB</span>(r, g, b) )
      minDist = Infinity
      ixMin = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
        d = Color.rgbDistance color.rgb..., r, g, b
        <span class="hljs-keyword">if</span> d &lt; minDist
          minDist = d
          ixMin = i
      @[ixMin]</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Utilities for creating color maps.
<a href="https://github.com/bpostlethwaite/colormap">https://github.com/bpostlethwaite/colormap</a></p>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Create a gray map of gray values (gray: r=g=b)
The optional size argument is the size of the map for
maps that are not all 256 grays.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">intensityArray</span>: <span class="hljs-function"><span class="hljs-params">(size = <span class="hljs-number">256</span>)</span> -&gt;</span>
    (Math.round(i*<span class="hljs-number">255</span>/(size-<span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..size])
  <span class="hljs-attribute">grayColorArray</span>: <span class="hljs-function"><span class="hljs-params">(size = <span class="hljs-number">256</span>)</span> -&gt;</span>
    ([i,i,i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-property">@intensityArray</span>(size))
  <span class="hljs-attribute">grayColorMap</span>: <span class="hljs-function"><span class="hljs-params">(size = <span class="hljs-number">256</span>, options)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap ([i,i,i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-property">@intensityArray</span>(size)), options</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Utility to create 3 uniform array ramps from 3 number arguments
If any arg is array, no change made.
If any arg is 1, replace with [255]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">threeArrays</span>: <span class="hljs-function"><span class="hljs-params">(A1,A2=A1,A3=A1)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>[A1, A2, A3] = ( (if A is 1 then [255] else A) for A in [A1, A2, A3] )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [A1, A2, A3] = <span class="hljs-keyword">for</span> A <span class="hljs-keyword">in</span> [A1, A2, A3] <span class="hljs-comment"># multi-line comprehension</span>
      <span class="hljs-keyword">if</span> A <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> A = [<span class="hljs-number">255</span>]
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> A <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span> <span class="hljs-keyword">then</span> u.aRamp(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, A, <span class="hljs-literal">true</span>) <span class="hljs-keyword">else</span> A
    [A1, A2, A3]</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Create a colormap by rgb values. R, G, B can be either a number,
the number of steps beteen 0-255, or an array of values to use
for the color.  Ex: R = 3, corresponds to [0, 128, 255]
The resulting map permutes the R, G, V values.  Thus if
R=G=B=4, the resulting map has 4<em>4</em>4=64 colors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbColorArray</span>: <span class="hljs-function"><span class="hljs-params">(R, G=R, B=R)</span> -&gt;</span>
    [R, G, B] = <span class="hljs-property">@threeArrays</span>(R, G, B)
    array=[]; ((array.push [r,g,b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> B) <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> G) <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> R
    array
  <span class="hljs-attribute">rgbColorMap</span>: <span class="hljs-function"><span class="hljs-params">(R, G=R, B=R, options)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@rgbColorArray</span>(R, G, B), options</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Create an hsb map with n hues, with constant saturation
and brightness.
hsvColorArray: (nHues=256, s=255, b=255) -&gt;</p>
<h1 id="-color-hsvtorgb-i-255-nhues-1-s-b-for-i-in-0-nhues-">(Color.hsvToRgb(i*255/(nHues-1), s, b) for i in [0…nHues])</h1>
<p>  (@hsvToRgb(i*255/(nHues-1), s, b) for i in [0…nHues])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">hsvColorArray</span>: <span class="hljs-function"><span class="hljs-params">(H, S=H, V=H)</span> -&gt;</span>
    [H, S, V] = <span class="hljs-property">@threeArrays</span>(H, S, V)
    array=[]; ((array.push [h, s, v] <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> H) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> S) <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> V
    ( (<span class="hljs-property">@hsvToRgb</span> a...) <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> array )
  <span class="hljs-attribute">hsvColorMap</span>: <span class="hljs-function"><span class="hljs-params">(H, S=[<span class="hljs-number">255</span>], V=H, options)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@hsvColorArray</span>(H, S, V), options</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Use the canvas gradient feature to create nColors.
This is a really sophisticated technique, see:
 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient">https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient</a>
 <a href="http://www.colorzilla.com/gradient-editor/">http://www.colorzilla.com/gradient-editor/</a>
 <a href="https://github.com/bpostlethwaite/colormap">https://github.com/bpostlethwaite/colormap</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">gradientColorArray</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs)</span> -&gt;</span>
    locs = (i/(stops.length-<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..stops.length]) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> locs?
    ctx = u.createCtx nColors, <span class="hljs-number">1</span>
    grad = ctx.createLinearGradient <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..stops.length]
      grad.addColorStop locs[i], <span class="hljs-property">@rgbString</span>(stops[i]...)
    ctx.fillStyle = grad
    ctx.fillRect <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">1</span>
    id = u.ctxToImageData(ctx).data
    ([id[i], id[i+<span class="hljs-number">1</span>], id[i+<span class="hljs-number">2</span>]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..id.length] <span class="hljs-keyword">by</span> <span class="hljs-number">4</span>)
  <span class="hljs-attribute">gradientColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs, options)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@gradientColorArray</span>(nColors, stops, locs), options</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Create a color map via the 140 html standard colors.
The input is an object of name: [r,g,b] pairs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">nameColorMap</span>: <span class="hljs-function"><span class="hljs-params">(colorPairs, options)</span> -&gt;</span>
    rgbs = ( v <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> colorPairs )
    names = ( k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> colorPairs )
    map = <span class="hljs-keyword">new</span> ColorMap rgbs, options, <span class="hljs-literal">true</span>
    <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> map
      name = names[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>color.name = name # bad idea, named colors can have duplicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      map.nameIndex[name] = color</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>map.nameIndex[name.toLowerCase()] = color</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    map</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Create a map with a random set of colors.
Sometimes useful to sort by intensity afterwards.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">randomColorArray</span>: <span class="hljs-function"><span class="hljs-params">(nColors)</span> -&gt;</span>
    <span class="hljs-function"><span class="hljs-title">rand255</span> = -&gt;</span> u.randomInt(<span class="hljs-number">256</span>)
    ([rand255(), rand255(), rand255()] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..nColors])
  <span class="hljs-attribute">randomColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nColors, options)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@randomColorArray</span>(nColors), options

};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
